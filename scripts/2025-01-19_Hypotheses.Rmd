---
title: "2024-08-14_Hypothesis1_MultilevelModel"
date: "`r Sys.Date()`"
output: 
  html_document: 
    theme: cosmo
    toc: yes
    toc_float: yes
---

**Attentional Biases in OCD**  
**Script Part II / ?**  
**Date: 24.07.2024**  
**Version: Version 2**  

# Description
This is the main analysis file of hypothesis 1 of the 044_EYE project on Attentional Biases in OCD. This script includes the multilevel model that aims to test the main hypotheses. Furthermore, this script contains tests of the assumptions of multilevel models as well as descriptive plots. 

## Hypotheses
### 1.) Vigilance Bias: 
Patients with **OCD** and patients with **spider phobia** attend to **idiosyncratic disorder-relevant material faster** than they do to **neutral** or **negative** material (vigilance bias), as indicated by the entry time to the corresponding region of interest. 
**Healthy participants** will **not show a bias** towards disorder-relevant stimuli compared to negative or neutral stimuli.

### 2.) Maintenance Bias:
**a.**	
Patients with **OCD** look at **idiosyncratic OCD-relevant material longer** compared to **neutral** or **negative** material (maintenance bias). 
**b.**	
Patients with **OCD** will show a **more pronounced maintenance bias** compared to **healthy** participants and, with regard to **idiosyncratic disorder-specific material**, compared to patients with **spider phobia**.

### 3.) Attentional Control
#### Subjective Measure
**a.**	
In patients with **OCD** and patients with **spider phobia**, there will be a **positive association** between **vigilance bias** and **attentional control** as measured by the self-report questionnaire (Attentional Control Scale). This means the lower the attentional control, the faster patients with OCD or spider phobia will look at OCD-relevant or spider-relevant material, respectively, compared to negative or neutral material.
**b.**	
In patients with **OCD**, there will be a **negative association** between the **maintenance bias** and **attentional control** as measured by the self-report questionnaire (Attentional Control Scale). This means the lower the attentional control, the longer patients will look at idiosyncratic OCD-relevant material compared to negative or neutral material.

####Objective Measure
**c.**
In patients with **OCD** and patients with **spider phobia**, there will be a positive association between **vigilance bias** and **attentional control** as measured by the objective measure (AX-CPT).
**d.**
In patients with **OCD**, there will be a **negative association** between the **maintenance bias** and **attentional control** as measured by the objective measure (AX-CPT).

### 4.) Stress 
The induction of **stress** significantly increases the **maintenance bias** in patients with **OCD** (state-level). This means that patients with OCD will **look at OCD-relevant material for longer** after the stress induction than before the stress induction.

**Install Packages**
```{r install packages, message=F, warning=F, include=F}
# install.packages("ROCR")
# install.packages("lavaan")
# install.packages("psych")               # for basic calculations
# install.packages("foreign")             # xxx
# install.packages("ggplot2")             # for figures
# install.packages("car")                 # xxx
# install.packages("corpcor")             # for correlations
# install.packages("Hmisc")               # xxx
# install.packages("polycor")             # xxx
# install.packages("apaTables")           # for exporting tables according to APA style
# install.packages("QuantPsyc")           # xxx
# install.packages("effsize")             # xxx
# install.packages("tidyverse")           # for transforming data
# install.packages("readxl")              # for loading and exporting datasets
# install.packages("writexl")             # for loading and exporting datasets
# install.packages("bannerCommenter")     # for section headers
# install.packages("reshape2")            # for reshaping datasets
# install.packages("responsePatterns")    # for check of response patterns
# install.packages("corrplot")            # for correlation tables
# install.packages("gsubfn")              # for subsetting strings
# install.packages("data.table")          # for creating data tables
# install.packages("RColorBrewer")        # for colours in plots
# install.packages("pals")                # for colours in plots
# install.packages("devtools")
# install.packages("usethis")
# install.packages("lavaan")              # required to run SEMs
# install.packages("lavModel")            # required to run SEMs
# install.packages("ROCR")                # required to create ROC curves
# install.packages("hdf5r")
# install.packages("edfReader")           # required to read edf files
# install.packages("githubinstall")       # required to install packages from github
# install.packages("eyelinker")           # eyelink specific package
# install_github("alexander-pastukhov/eyelinkReader")                 # eyelink specific package
# install_github("aleksandernitka/EyeTracking_Tobii_VAS_IOHUB")  # eyelink specific package
# install.packages("gaze_analysis.R")     # for gaze analyses
# install.packages("report")              # to report results of anova
# install.packages("gazeR")                 # to preprocess eyetracking data
# install.packages("janitor")
# install.packages("multcomp")            # for multiple comparisons
# install.packages("lmerTest")            # for post-hoc tests of LMMs
# install.packages("JuliaCall")           # for coding in julia
# install.packages("sjPlot")              # for creating tables on LMM output
# install.packages("DT")                  # for creating datatables in R Markdown
```

**Load Packages**
```{r load packages, message=F, warning=F, include=F}
library("data.table")
library("writexl")
library("stats")
library("ggplot2")
library("tidyr")
library("dplyr")
library("report")
library("janitor")
library("lme4")
library("multcomp")
library("lmerTest")
library("JuliaCall")
library("sjPlot")
library("DT")
```

**Define the Colour Scheme**
```{r colour scheme, message=F, warning=F, include=F}
color1 <- "#003C6799"
color2 <- "#CD534C99"
color3 <- 'lightgoldenrod1'
color4 <- "darkseagreen"
```

# Install Julia
```{r install julia}
library(JuliaCall)
options(JULIA_HOME = "/Applications/Julia-1.11.app/Contents/Resources/julia/bin") # need to define the path for my Mac to resolve bug
j = julia_setup(installJulia = TRUE)
```

## Install Julia Packages
```{julia install julia packages, echo = F}
using Pkg
Pkg.activate(".")
Pkg.add(["MixedModels","JellyMe4","RCall"])
  
ENV["LMER"] ="lmerTest::lmer"
```

# Load Data 
```{r load data}
# data_dwelltime = read.csv("../data/data_dwelltime_OA.csv")
# data_entrytime = read.csv("../data/data_entrytime_OA.csv")
data_dwelltime = read.csv("/Volumes/109-psy-kp-study/044_EYE/06_Results/02_Hauptstudie/FilesAnalysis/data_dwelltime_OA.csv")
data_entrytime = read.csv("/Volumes/109-psy-kp-study/044_EYE/06_Results/02_Hauptstudie/FilesAnalysis/data_entrytime_OA.csv")

# Ensure participant IDs match between entry-time and dwell-time datasets
data_entrytime$participant = data_dwelltime$participant

# Set reaction time (rt) for the left stimulus using the first entry time to the lower-left position
data_entrytime$rt = data_entrytime$first_entry_time_left

# For trials where the right stimulus was fixated first, update reaction time with the first entry time to the upper-right position
ix_right = is.na(data_entrytime$first_entry_time_left)
data_entrytime$rt[ix_right] = data_entrytime$first_entry_time_right[ix_right]

# Determine which stimulus (lower-left or upper-right) was fixated first and store the corresponding stimulus ID (2 = left, 1 = right -> recoded to 0 = left, 1 = right)
data_entrytime$response = data_entrytime$first_entry_ID_left
data_entrytime$response[ix_right] = data_entrytime$first_entry_ID_right[ix_right]
data_entrytime <- data_entrytime %>%
  dplyr::mutate(response = ifelse(response == 2, 0,
                           ifelse(response == 1, 1, NA)))

# Set contrasts for stimuli attributes based on their positions (lower-left: -1, upper-right: +1)
data_entrytime$ocd_left = data_entrytime$ocd_relevant_left == 1
data_entrytime$ocd_right = data_entrytime$ocd_relevant_right == 1

data_entrytime$pho_left = data_entrytime$spider_relevant_left == 1
data_entrytime$pho_right = data_entrytime$spider_relevant_right == 1

data_entrytime$neg_left = data_entrytime$negative_left == 1
data_entrytime$neg_right = data_entrytime$negative_right == 1

data_entrytime$neu_left = data_entrytime$neutral_left == 1
data_entrytime$neu_right = data_entrytime$neutral_right == 1

# Identify which direction the participant looked first (ir = upper-right, il = lower-left)
data_entrytime$looked_right = is.na(data_entrytime$first_entry_ID_left)
ir = data_entrytime$looked_right
il = !data_entrytime$looked_right

# Initialize columns to store the type of stimulus looked at and not looked at
data_entrytime$looked_at = 'neutral'
data_entrytime$not_looked_at = 'neutral'

# Set 'looked_at' based on whether the first fixation was on the lower-left or upper-right stimulus with specific attributes
ix = (il & data_entrytime$pho_left) | (ir & data_entrytime$pho_right)
data_entrytime$looked_at[ix] = "pho"

ix = (il & data_entrytime$ocd_left) | (ir & data_entrytime$ocd_right)
data_entrytime$looked_at[ix] = "ocd"

ix = (il & data_entrytime$neg_left) | (ir & data_entrytime$neg_right)
data_entrytime$looked_at[ix] = "neg"

# Set 'not_looked_at' based on the attribute of the stimulus that was not fixated on first
ix = (ir & data_entrytime$pho_left) | (il & data_entrytime$pho_right)
data_entrytime$not_looked_at[ix] = "pho"

ix = (ir & data_entrytime$ocd_left) | (il & data_entrytime$ocd_right)
data_entrytime$not_looked_at[ix] = "ocd"

ix = (ir & data_entrytime$neg_left) | (il & data_entrytime$neg_right)
data_entrytime$not_looked_at[ix] = "neg"
```

# Hypothesis 1: Maintenance Bias 
**From Complex to Simple Multilevel Models**
## Hypothesis 1: Create Models
```{r create julia models for H1}
#j $assign("form", formula(mlm_dwelltime))
j$assign("jl_data_dwelltime", data_dwelltime)
j$assign("jl_data_entrytime", data_entrytime)
julia_command("jl_data_entrytime.response .= jl_data_entrytime.response .-1")
julia_command("using MixedModels")
julia_command("using JellyMe4")
julia_command("using Pkg")
julia_command('Pkg.add("NLopt")')
julia_command("using NLopt")
```


```{julia create contrast H1}
c_dwelltime = Dict(:group=>DummyCoding(;base="healthy"))
```


```{r create julia models for H1_2}
# # Model 1: Most Complex Model
# julia_command("h1_fm_complex = @formula(dwell_diff ~ group + stim_ocd + stim_pho + stim_neg + group&stim_ocd + group&stim_pho + group&stim_neg +
#               (1 + stim_ocd + stim_pho + stim_neg | triplet)+
#               (1 + stim_ocd + stim_pho + stim_neg | participant) +
#               (1 + group | picture_pair_countingindex))")
# 
# # Model 2a: Triplet ZeroCorr
# julia_command("h1_fm_triplet_zerocorr = @formula(dwell_diff ~ group + stim_ocd + stim_pho + stim_neg + group&stim_ocd + group&stim_pho + group&stim_neg + 
#               zerocorr(1 + stim_ocd + stim_pho + stim_neg | triplet)+
#               (1 + stim_ocd + stim_pho + stim_neg | participant) +
#               (1 + group | picture_pair_countingindex))")
# 
# # Model 2b: Triplet and Participant ZeroCorr
# julia_command("h1_fm_triplet_id_zerocorr = @formula(dwell_diff ~ group + stim_ocd + stim_pho + stim_neg + group&stim_ocd + group&stim_pho + group&stim_neg + 
#               zerocorr(1 + stim_ocd + stim_pho + stim_neg | triplet)+
#               zerocorr(1 + stim_ocd + stim_pho + stim_neg | participant) +
#               (1 + group | picture_pair_countingindex))")
# 
# # Model 2c: Triplet, Participant and Item Effect ZeroCorr
# julia_command("h1_fm_triplet_id_item_zerocorr = @formula(dwell_diff ~ group + stim_ocd + stim_pho + stim_neg + group&stim_ocd + group&stim_pho + group&stim_neg + 
#               zerocorr(1 + stim_ocd + stim_pho + stim_neg | triplet)+
#               zerocorr(1 + stim_ocd + stim_pho + stim_neg | participant) +
#               zerocorr(1 + group | picture_pair_countingindex))")
# 
# # Model 3a: Exclude Participant
# julia_command("h1_fm_excl_id = @formula(dwell_diff ~ group + stim_ocd + stim_pho + stim_neg + group&stim_ocd + group&stim_pho + group&stim_neg +
#               (1 + stim_ocd + stim_pho + stim_neg | triplet)+
#               (1 + group | picture_pair_countingindex))")
# 
# # Model 3b: Exclude Triplet
# julia_command("h1_fm_excl_triplet = @formula(dwell_diff ~ group + stim_ocd + stim_pho + stim_neg + group&stim_ocd + group&stim_pho + group&stim_neg + 
#               (1 + stim_ocd + stim_pho + stim_neg | participant)+
#               (1 + group | picture_pair_countingindex))")
# 
# # Model 3c: Exclude Item
# julia_command("h1_fm_excl_item  = @formula(dwell_diff ~ group + stim_ocd + stim_pho + stim_neg + group&stim_ocd + group&stim_pho + group&stim_neg +
#               (1 + stim_ocd + stim_pho + stim_neg | triplet)+
#               (1 + stim_ocd + stim_pho + stim_neg | participant))")
# 
# # Model 4a: Exclude Participant and Triplet
# julia_command("h1_fm_excl_triplet_id = @formula(dwell_diff ~ group + stim_ocd + stim_pho + stim_neg + group&stim_ocd + group&stim_pho + group&stim_neg + 
#               (1 + group | picture_pair_countingindex))")

# Model 4b: Exclude Triplet and Item
julia_command("h1_fm_excl_triplet_item = @formula(dwell_diff ~ group + stim_ocd + stim_pho + stim_neg + group&stim_ocd + group&stim_pho + group&stim_neg + 
              (1 + stim_ocd + stim_pho + stim_neg | participant))")

# # Model 4c: Exclude Participant and Item
# julia_command("h1_fm_excl_id_item = @formula(dwell_diff ~ group + stim_ocd + stim_pho + stim_neg + group&stim_ocd + group&stim_pho + group&stim_neg + 
#             (1 + stim_ocd + stim_pho + stim_neg | triplet))")
```

## Hypothesis 1: Run Models 
```{r run julia models for H1}
# # Model 1
# julia_command("h1_fm_complex = fit(LinearMixedModel, h1_fm_complex, jl_data_dwelltime)")
# 
# # Models 2: Zero Correlation
# julia_command("h1_fm_trip_zc = fit(LinearMixedModel, h1_fm_triplet_zerocorr, jl_data_dwelltime)")
# julia_command("h1_fm_trip_id_zc = fit(LinearMixedModel, h1_fm_triplet_id_zerocorr, jl_data_dwelltime)")
# julia_command("h1_fm_trip_id_item_zc = fit(LinearMixedModel, h1_fm_triplet_id_item_zerocorr, jl_data_dwelltime)")
# 
# # Models 3: Exclude One Random Effect
# julia_command("h1_fm_excl_id = fit(LinearMixedModel, h1_fm_excl_id, jl_data_dwelltime)")
# julia_command("h1_fm_excl_triplet = fit(LinearMixedModel, h1_fm_excl_triplet, jl_data_dwelltime)")
# julia_command("h1_fm_excl_item = fit(LinearMixedModel, h1_fm_excl_item, jl_data_dwelltime)")

# Models 4: Exclude Two Random Effects
# julia_command("h1_fm_excl_triplet_id = fit(LinearMixedModel, h1_fm_excl_triplet_id, jl_data_dwelltime)")
julia_command("h1_fm_excl_triplet_item = fit(LinearMixedModel, h1_fm_excl_triplet_item, jl_data_dwelltime; contrasts=c_dwelltime)")
# julia_command("h1_fm_excl_id_item = fit(LinearMixedModel, h1_fm_excl_id_item, jl_data_dwelltime)")
```


## Hypothesis 1: Translate Models to R
```{r translate julia models for H1}
# Model 1: Complex Model
# h1_fm_complex <- julia_eval("robject(:lmerMod, Tuple([h1_fm_complex,jl_data_dwelltime]));",need_return="R")

# Models 2: Zero Correlation
# h1_fm_trip_zc <- julia_eval("robject(:lmerMod, Tuple([h1_fm_trip_zc,jl_data_dwelltime]));",need_return="R")
# h1_fm_trip_id_zc <- julia_eval("robject(:lmerMod, Tuple([h1_fm_trip_id_zc,jl_data_dwelltime]));",need_return="R")
# h1_fm_trip_id_item_zc <- julia_eval("robject(:lmerMod, Tuple([h1_fm_trip_id_item_zc,jl_data_dwelltime]));",need_return="R") # error happens in Julia: Error in getStart(start, rho$pp) : incorrect number of theta components (!=15)

# Models 3: Exclude One Random Effect
# h1_fm_excl_id <- julia_eval("robject(:lmerMod, Tuple([h1_fm_excl_id,jl_data_dwelltime]));",need_return="R")
# h1_fm_excl_triplet <- julia_eval("robject(:lmerMod, Tuple([h1_fm_excl_triplet,jl_data_dwelltime]));",need_return="R")
# h1_fm_excl_item <- julia_eval("robject(:lmerMod, Tuple([h1_fm_excl_item,jl_data_dwelltime]));",need_return="R")

# Models 4: Exclude Two Random Effects
# h1_fm_excl_triplet_id <- julia_eval("robject(:lmerMod, Tuple([h1_fm_excl_triplet_id,jl_data_dwelltime]));",need_return="R")
h1_fm_excl_triplet_item <- julia_eval("robject(:lmerMod, Tuple([h1_fm_excl_triplet_item,jl_data_dwelltime]));",need_return="R")
# h1_fm_excl_id_item <- julia_eval("robject(:lmerMod, Tuple([h1_fm_excl_id_item,jl_data_dwelltime]));",need_return="R")
```

### Hypothesis 1: Evaluate Best Fitting Model 
```{r evaluate best fitting model H1}
# h1_fm_complex, h1_fm_trip_id_item_zc,
# anova(h1_fm_excl_id, h1_fm_trip_zc, h1_fm_trip_id_zc, h1_fm_excl_triplet, h1_fm_excl_item, h1_fm_excl_triplet_id, h1_fm_excl_triplet_item, h1_fm_excl_id_item)

# best: h1_fm_excl_triplet_item

summary(h1_fm_excl_triplet_item)
tab_model(h1_fm_excl_triplet_item)

# Export
tab_model(h1_fm_excl_triplet_item, file = "/Volumes/109-psy-kp-study/044_EYE/06_Results/02_Hauptstudie/MaintenanceBias/summary_h1_fm_excl_triplet_item.doc")
```


## Hypothesis 1: Test of Hypotheses With Contrasts
To establish contrast codes that directly test the hypotheses, we first code the hypotheses we want to test. Then, we fit the established effects in the contrast() function. This function allows direct inspection of effects. The p-values are estimated by the Satterthwaite method. The p-values are unadjusted.

*Maintenance Bias:*
**a.**
Patients with *OCD* look at *idiosyncratic OCD-relevant material longer* compared to *neutral* or *negative* material (maintenance bias). 
**b.**
Patients with *OCD* will show a *more pronounced maintenance bias* compared to *healthy* participants and, with regard to *idiosyncratic disorder-specific material*, compared to patients with *spider phobia*.

```{r generalised hypotheses matrices}
# Define the model comparisons to test the specific hypothesis of hypothesis 2
g_h1_directional <- glht(h1_fm_excl_triplet_item, 
                      linfct = c(
                                "stim_ocd + groupocd:stim_ocd >= 0", # Patients with OCD look at idiosyncratic OCD-relevant material longer compared to neutral material (maintenance bias within group)
                                
                                "(stim_ocd + groupocd:stim_ocd) - (stim_neg + groupocd:stim_neg) >= 0", # Patients with OCD look at idiosyncratic OCD-relevant material longer compared to negative material (maintenance bias within group)
                                
                                "groupocd + groupocd:stim_ocd >= 0", # Patients with OCD will show a more pronounced maintenance bias compared to healthy participants (maintenance bias between groups)
                                
                                "(groupocd + stim_ocd + groupocd:stim_ocd) -  (groupspider + stim_pho + groupspider:stim_pho) >= 0" # Patients with OCD will show a more pronounced maintenance to idiosyncratic disorder-specific material compared to patients with spider phobia (maintenance bias between group)
                                 ))

g_h1_equality <- glht(h1_fm_excl_triplet_item, 
                   linfct = c(
                              "stim_neg + groupocd:stim_neg = 0", 
                              # Patients with OCD will not show a bias towards negative stimuli compared to neutral stimuli
                     
                              "stim_neg + groupspider:stim_neg = 0", 
                              # Patients with spider phobia will not show a bias towards negative stimuli compared to neutral stimuli
                              
                              "stim_neg = 0" 
                              # Healthy participants will not show a bias towards negative stimuli compared to neutral stimuli
                              ))


# Satterthwaite is a more conservative method than the likelihood ratio test
# Likelihood ratio tests always compares two models with each other
# this is easy when the contrast is a treatment effect, but more difficult if we have three variables
# Deviation from preregistration - but this option is better, as
# 1. Contrasts are more easily to be implemented with contest(), as we have many different contrasts and three groups that we want to compare within- and between-subjects (LR would only allow two comparisons at a time)
# Contest Directional Hypotheses
contest(h1_fm_excl_triplet_item,g_h1_directional$linfct,joint=FALSE,ddf="Satterthwaite")

# Contest Equality Hypotheses
contest(h1_fm_excl_triplet_item,g_h1_equality$linfct,joint=FALSE,ddf="Satterthwaite")

# Create Data Tables 
rownames_h1_contrast_directional <- c("stim_ocd + groupocd:stim_ocd", 
                           "(stim_ocd + groupocd:stim_ocd) - (stim_neg + groupocd:stim_neg)", 
                           "stim_pho + groupspider:stim_pho",
                           "(stim_pho + groupspider:stim_pho) - (stim_neg + groupspider:stim_neg)")

rownames_h1_contrast_equality <- c("stim_neg + groupocd:stim_neg", 
                                    "stim_neg + groupspider:stim_neg", 
                                    "stin_neg")

h1_contrasts_directional <- as.data.table(contest(h1_fm_excl_triplet_item,g_h1_directional$linfct,joint=FALSE,ddf="Satterthwaite"))
h1_contrasts_directional <- h1_contrasts_directional %>%
  dplyr::mutate(contrast = rownames_h1_contrast_directional) %>%
  dplyr::relocate(contrast, .before = Estimate)

h1_contrasts_equality <- as.data.table(contest(h1_fm_excl_triplet_item,g_h1_equality$linfct,joint=FALSE,ddf="Satterthwaite"))
h1_contrasts_equality <- h1_contrasts_equality %>%
  dplyr::mutate(contrast = rownames_h1_contrast_equality) %>%
  dplyr::relocate(contrast, .before = Estimate)

h1_contrasts <- full_join(h1_contrasts_directional, h1_contrasts_equality)
datatable(h1_contrasts)

# Export 
write_xlsx(h1_contrasts, "/Volumes/109-psy-kp-study/044_EYE/06_Results/02_Hauptstudie/MaintenanceBias/h1_contrasts.xlsx")
```

*Guideline of Interpretation:*
**1. Contrast: OCD vs. neutral in OCD group**

A positive value would indicate that OCD-relevant stimuli elicit longer gaze durations than neutral stimuli within the OCD group.

A negative value would indicate that neutral stimuli elicit longer gaze durations than OCD-relevant stimuli within the OCD group.

**2. Contrast**

A positive value would indicate that OCD-relevant stimuli elicit longer gaze durations than negative stimuli within the OCD group.

A negative value would indicate that negative stimuli elicit longer gaze durations than OCD-relevant stimuli within the OCD group.

**3. Contrast: OCD group will show a more pronounced maintenance bias as compared to healthy participants**
A positive value would indicate that OCD patients have longer gaze durations on idiosyncratically OCD-relevant material than healthy individuals do on the same type of stimuli.

--> Essentially, this would mean that the maintenance bias effect in OCD patients is more pronounced compared to the healthy group when looking at OCD-relevant stimuli.

A negative value would indicate that OCD patients have shorter gaze durations on idiosyncratically OCD-relevant stimuli compared to the healthy group’s gaze durations on the same type of stimuli.

**4. Contrast: OCD group will show a more pronounced maintenance bias as compared to spider phobia patients**

A positive value would indicate that OCD patients have longer gaze durations on idiosyncratically OCD-relevant material than spider phobia patients do on their idiosyncratically spider-relevant material. 

--> Essentially, this would mean that the maintenance bias effect in OCD patients is more pronounced compared to the healthy group when looking at OCD-relevant stimuli.

A negative value would indicate that OCD patients have shorter gaze durations on idiosyncratically OCD-relevant stimuli compared to the spider phobia group's gaze on their idiosyncratically spider-relevant material. 


### Hypothesis 1 - Sensitivity Analysis: Exclduing 0 Fixations on AOI
```{r h1 sensitivity analysis - excl. 0 dwelltime}
data_dwelltime_excl0 <- data_dwelltime %>%
  dplyr::filter(!c(IA_FIXATION_COUNT_left == 0 | IA_FIXATION_COUNT_right == 0))

#j $assign("form", formula(mlm_dwelltime))
j$assign("jl_data_dwelltime_excl0", data_dwelltime_excl0)
julia_command("using MixedModels")
julia_command("using JellyMe4")

# Model 4b: Exclude Triplet and Item
julia_command("h1_fm_excl_triplet_item_excl0 = @formula(dwell_diff ~ group + stim_ocd + stim_pho + stim_neg + group&stim_ocd + group&stim_pho + group&stim_neg + 
              (1 + stim_ocd + stim_pho + stim_neg | participant))")

julia_command("h1_fm_excl_triplet_item_excl0 = fit(LinearMixedModel, h1_fm_excl_triplet_item_excl0, jl_data_dwelltime_excl0)")

h1_fm_excl_triplet_item_excl0 <- julia_eval("robject(:lmerMod, Tuple([h1_fm_excl_triplet_item_excl0,jl_data_dwelltime_excl0]));",need_return="R")

summary(h1_fm_excl_triplet_item_excl0)
tab_model(h1_fm_excl_triplet_item_excl0)

# Export
tab_model(h1_fm_excl_triplet_item_excl0, file = "/Volumes/109-psy-kp-study/044_EYE/06_Results/02_Hauptstudie/MaintenanceBias/summary_h1_fm_excl_triplet_item_excl0.doc")

# Define the model comparisons to test the specific hypothesis of hypothesis 1
# Define the model comparisons to test the specific hypothesis of hypothesis 2
excl0_g_h1_directional <- glht(h1_fm_excl_triplet_item_excl0, 
                      linfct = c(
                                "stim_ocd + groupocd:stim_ocd >= 0", # Patients with OCD look at idiosyncratic OCD-relevant material longer compared to neutral material (maintenance bias within group)
                                
                                "(stim_ocd + groupocd:stim_ocd) - (stim_neg + groupocd:stim_neg) >= 0", # Patients with OCD look at idiosyncratic OCD-relevant material longer compared to negative material (maintenance bias within group)
                                
                                "groupocd + groupocd:stim_ocd >= 0", # Patients with OCD will show a more pronounced maintenance bias compared to healthy participants (maintenance bias between groups)
                                
                                "(groupocd + stim_ocd + groupocd:stim_ocd) -  (groupspider + stim_pho + groupspider:stim_pho) >= 0" # Patients with OCD will show a more pronounced maintenance to idiosyncratic disorder-specific material compared to patients with spider phobia (maintenance bias between group)
                                 ))

excl0_g_h1_equality <- glht(h1_fm_excl_triplet_item_excl0, 
                   linfct = c(
                              "stim_neg + groupocd:stim_neg = 0", 
                              # Patients with OCD will not show a bias towards negative stimuli compared to neutral stimuli
                     
                              "stim_neg + groupspider:stim_neg = 0", 
                              # Patients with spider phobia will not show a bias towards negative stimuli compared to neutral stimuli
                              
                              "stim_neg = 0" 
                              # Healthy participants will not show a bias towards negative stimuli compared to neutral stimuli
                              ))


# Satterthwaite is a more conservative method than the likelihood ratio test
# Likelihood ratio tests always compares two models with each other
# this is easy when the contrast is a treatment effect, but more difficult if we have three variables
# Deviation from preregistration - but this option is better, as
# 1. Contrasts are more easily to be implemented with contest(), as we have many different contrasts and three groups that we want to compare within- and between-subjects (LR would only allow two comparisons at a time)
# Contest Directional Hypotheses
contest(h1_fm_excl_triplet_item_excl0,excl0_g_h1_directional$linfct,joint=FALSE,ddf="Satterthwaite")

# Contest Equality Hypotheses
contest(h1_fm_excl_triplet_item_excl0,excl0_g_h1_equality$linfct,joint=FALSE,ddf="Satterthwaite")

# Create Data Tables 
rownames_h1_contrast_excl0directional <- c("stim_ocd + groupocd:stim_ocd", 
                           "(stim_ocd + groupocd:stim_ocd) - (stim_neg + groupocd:stim_neg)", 
                           "stim_pho + groupspider:stim_pho",
                           "(stim_pho + groupspider:stim_pho) - (stim_neg + groupspider:stim_neg)")

rownames_h1_contrast_excl0equality <- c("stim_neg + groupocd:stim_neg", 
                                    "stim_neg + groupspider:stim_neg", 
                                    "stin_neg")

h1_contrasts_excl0_directional <- as.data.table(contest(h1_fm_excl_triplet_item_excl0,excl0_g_h1_directional$linfct,joint=FALSE,ddf="Satterthwaite"))
h1_contrasts_excl0_directional <- h1_contrasts_excl0_directional %>%
  dplyr::mutate(contrast = rownames_h1_contrast_excl0directional) %>%
  dplyr::relocate(contrast, .before = Estimate)

h1_contrasts_excl0_equality <- as.data.table(contest(h1_fm_excl_triplet_item_excl0,excl0_g_h1_equality$linfct,joint=FALSE,ddf="Satterthwaite"))
h1_contrasts_excl0_equality <- h1_contrasts_excl0_equality %>%
  dplyr::mutate(contrast = rownames_h1_contrast_excl0equality) %>%
  dplyr::relocate(contrast, .before = Estimate)

h1_contrasts_excl0 <- full_join(h1_contrasts_excl0_directional, h1_contrasts_excl0_equality)
datatable(h1_contrasts_excl0)

# Export
write_xlsx(h1_contrasts_excl0, "/Volumes/109-psy-kp-study/044_EYE/06_Results/02_Hauptstudie/MaintenanceBias/h1_contrasts_excl0.xlsx")
```


# Hypothesis 2: Vigilance Bias - Choice of First Fixation

**From Complex to Simple Multilevel Models**
```{r create julia models for H2a choice}
# # Model 1: Most Complex Model
# julia_command("h2a_glm_fm_complex = @formula(response ~ group + stim_ocd + stim_pho + stim_neg + group&stim_ocd + group&stim_pho + group&stim_neg + 
#               (1 + stim_ocd + stim_pho + stim_neg | triplet)+
#               (1 + stim_ocd + stim_pho + stim_neg | participant) +
#               (1 + group | picture_pair_countingindex))")
# 
# # Model 2a: Triplet ZeroCorr
# julia_command("h2a_glm_fm_triplet_zerocorr = @formula(response ~ group + stim_ocd + stim_pho + stim_neg + group&stim_ocd + group&stim_pho + group&stim_neg + 
#               zerocorr(1 + stim_ocd + stim_pho + stim_neg | triplet)+
#               (1 + stim_ocd + stim_pho + stim_neg | participant) +
#               (1 + group | picture_pair_countingindex))")
# 
# # Model 2b: Triplet and Participant ZeroCorr
# julia_command("h2a_glm_fm_triplet_id_zerocorr = @formula(response ~ group + stim_ocd + stim_pho + stim_neg + group&stim_ocd + group&stim_pho + group&stim_neg + 
#               zerocorr(1 + stim_ocd + stim_pho + stim_neg | triplet)+
#               zerocorr(1 + stim_ocd + stim_pho + stim_neg | participant) +
#               (1 + group | picture_pair_countingindex))")
# 
# # Model 2c: Triplet, Participant and Item Effect ZeroCorr
# julia_command("h2a_glm_fm_triplet_id_item_zerocorr = @formula(response ~ group + stim_ocd + stim_pho + stim_neg + group&stim_ocd + group&stim_pho + group&stim_neg + 
#               zerocorr(1 + stim_ocd + stim_pho + stim_neg | triplet)+
#               zerocorr(1 + stim_ocd + stim_pho + stim_neg | participant) +
#               zerocorr(1 + group | picture_pair_countingindex))")
# 
# # Model 3a: Exclude Participant
# julia_command("h2a_glm_fm_excl_id = @formula(response ~ group + stim_ocd + stim_pho + stim_neg + group&stim_ocd + group&stim_pho + group&stim_neg + 
#               (1 + stim_ocd + stim_pho + stim_neg | triplet)+
#               (1 + group | picture_pair_countingindex))")
# 
# # Model 3b: Exclude Triplet
# julia_command("h2a_glm_fm_excl_triplet = @formula(response ~ group + stim_ocd + stim_pho + stim_neg + group&stim_ocd + group&stim_pho + group&stim_neg + 
#               (1 + stim_ocd + stim_pho + stim_neg | participant)+
#               (1 + group | picture_pair_countingindex))")
# 
# # Model 3c: Exclude Item
# julia_command("h2a_glm_fm_excl_item  = @formula(response ~ group + stim_ocd + stim_pho + stim_neg + group&stim_ocd + group&stim_pho + group&stim_neg +
#               (1 + stim_ocd + stim_pho + stim_neg | triplet)+
#               (1 + stim_ocd + stim_pho + stim_neg | participant))")
# 
# # Model 4a: Exclude Participant and Triplet
# julia_command("h2a_glm_fm_excl_triplet_id = @formula(response ~ group + stim_ocd + stim_pho + stim_neg + group&stim_ocd + group&stim_pho + group&stim_neg + 
#               (1 + group | picture_pair_countingindex))")

# Model 4b: Exclude Triplet and Item
julia_command("h2a_glm_fm_excl_triplet_item = @formula(response ~ group + stim_ocd + stim_pho + stim_neg + group&stim_ocd + group&stim_pho + group&stim_neg + 
              (1 + stim_ocd + stim_pho | participant))")
# 
# # Model 4c: Exclude Participant and Item
# julia_command("h2a_glm_fm_excl_id_item = @formula(response ~ group + stim_ocd + stim_pho + stim_neg + group&stim_ocd + group&stim_pho + group&stim_neg + 
#               (1 + stim_ocd + stim_pho + stim_neg | triplet))")
```

## Hypothesis 2a: Run Models 

```{julia define contrasts entrytime}
using RCall
using MixedModels
using JellyMe4
jl_data_entrytime = @rget data_entrytime

c_entrytime = Dict(:group=>DummyCoding(;base="healthy"))
```

```{r run julia models for H2a}
# # Model 1
# julia_command("h2a_glm_fm_complex = fit(MixedModel, h2a_glm_fm_complex, jl_data_entrytime;contrasts=c_entrytime)")
# 
# # Models 2: Zero Correlation
# julia_command("h2a_glm_fm_trip_zc = fit(MixedModel, h2a_glm_fm_triplet_zerocorr, jl_data_entrytime;contrasts=c_entrytime)")
# julia_command("h2a_glm_fm_trip_id_zc = fit(MixedModel, h2a_glm_fm_triplet_id_zerocorr, jl_data_entrytime;contrasts=c_entrytime)")
# julia_command("h2a_glm_fm_trip_id_item_zc = fit(MixedModel, h2a_glm_fm_triplet_id_item_zerocorr, jl_data_entrytime;contrasts=c_entrytime)")
# 
# # Models 3: Exclude One Random Effect
# julia_command("h2a_glm_fm_excl_id = fit(MixedModel, h2a_glm_fm_excl_id, jl_data_entrytime;contrasts=c_entrytime)")
# julia_command("h2a_glm_fm_excl_triplet = fit(MixedModel, h2a_glm_fm_excl_triplet, jl_data_entrytime;contrasts=c_entrytime)")
# julia_command("h2a_glm_fm_excl_item = fit(MixedModel, h2a_glm_fm_excl_item, jl_data_entrytime;contrasts=c_entrytime)")
# 
# # Models 4: Exclude Two Random Effects
# julia_command("h2a_glm_fm_excl_triplet_id = fit(MixedModel, h2a_glm_fm_excl_triplet_id, jl_data_entrytime;contrasts=c_entrytime)")
julia_command("h2a_glm_fm_excl_triplet_item = fit(MixedModel, h2a_glm_fm_excl_triplet_item, jl_data_entrytime;contrasts=c_entrytime)")
# julia_command("h2a_glm_fm_excl_id_item = fit(MixedModel, h2a_glm_fm_excl_id_item, jl_data_entrytime;contrasts=c_entrytime)")
```

## Hypothesis 2a: Translate Models to R
```{r translate julia models for H2a}
# Model 1: Complex Model
# h2a_glm_fm_complex <- julia_eval("robject(:lmerMod, Tuple([h2a_glm_fm_complex,jl_data_entrytime]));",need_return="R")

# # Models 2: Zero Correlation
# h2a_glm_fm_trip_zc <- julia_eval("robject(:lmerMod, Tuple([h2a_glm_fm_trip_zc,jl_data_entrytime]));",need_return="R")
# h2a_glm_fm_trip_id_zc <- julia_eval("robject(:lmerMod, Tuple([h2a_glm_fm_trip_id_zc,jl_data_entrytime]));",need_return="R")
# h2a_glm_fm_trip_id_item_zc <- julia_eval("robject(:lmerMod, Tuple([h2a_glm_fm_trip_id_item_zc,jl_data_entrytime]));",need_return="R")
# 
# # Models 3: Exclude One Random Effect
# h2a_glm_fm_excl_id <- julia_eval("robject(:lmerMod, Tuple([h2a_glm_fm_excl_id,jl_data_entrytime]));",need_return="R")
# h2a_glm_fm_excl_triplet <- julia_eval("robject(:lmerMod, Tuple([h2a_glm_fm_excl_triplet,jl_data_entrytime]));",need_return="R")
# h2a_glm_fm_excl_item <- julia_eval("robject(:lmerMod, Tuple([h2a_glm_fm_excl_item,jl_data_entrytime]));",need_return="R")
# 
# # Models 4: Exclude Two Random Effects
# h2a_glm_fm_excl_triplet_id <- julia_eval("robject(:lmerMod, Tuple([h2a_glm_fm_excl_triplet_id,jl_data_entrytime]));",need_return="R")
h2a_glm_fm_excl_triplet_item <- julia_eval("robject(:lmerMod, Tuple([h2a_glm_fm_excl_triplet_item,jl_data_entrytime]));",need_return="R")
# h2a_glm_fm_excl_id_item <- julia_eval("robject(:lmerMod, Tuple([h2a_glm_fm_excl_id_item,jl_data_entrytime]));",need_return="R")
```

### Evaluate Best Fitting Model 
```{r evaluate best fitting model H2a}
#h2a_glm_fm_complex, h2a_glm_fm_trip_id_item_zc
# anova(h2a_glm_fm_trip_zc, h2a_glm_fm_trip_id_zc, h2a_glm_fm_excl_id, h2a_glm_fm_excl_triplet, h2a_glm_fm_excl_item, h2a_glm_fm_excl_triplet_id, h2a_glm_fm_excl_triplet_item, h2a_glm_fm_excl_id_item)

# best: h2a_glm_fm_excl_triplet_item
summary(h2a_glm_fm_excl_triplet_item)
tab_model(h2a_glm_fm_excl_triplet_item)

# Export 
tab_model(h2a_glm_fm_excl_triplet_item, file = "/Volumes/109-psy-kp-study/044_EYE/06_Results/02_Hauptstudie/VigilanceBias/summary_h2a_glm_fm_excl_triplet_item.doc")
```

## Hypothesis 2a: Test of Choice Hypothesis With Contrasts
To establish contrast codes that directly test the hypotheses, we first code the hypotheses we want to test. Then, we fit the established effects in the contrast() function. This function allows direct inspection of effects. The p-values are estimated by the Satterthwaite method. The p-values are unadjusted.

**Hypothesis:** 
Patients with **OCD** and patients with **spider phobia** attend to **idiosyncratic disorder-relevant material faster** than they do to **neutral** or **negative** material (vigilance bias), as indicated by the entry time to the corresponding region of interest. 
**Healthy participants** will **not show a bias** towards disorder-relevant stimuli compared to negative or neutral stimuli.

```{r h2a generalised hypotheses matrices}
# Define the model comparisons to test the specific hypothesis of hypothesis 2
g_h2a_directional <- glht(h2a_glm_fm_excl_triplet_item, 
                      linfct = c("stim_ocd + groupocd:stim_ocd >= 0", 
                                 # Patients with OCD are more likely to first fixate on OCD-relevant material compared to neutral material
                                 
                                 "(stim_ocd + groupocd:stim_ocd) - (stim_neg + groupocd:stim_neg) >= 0", 
                                 # Patients with OCD are more likely to first fixate on OCD-relevant material compared to negative material
                                 
                                 "stim_pho + groupspider:stim_pho >= 0", 
                                 # Patients with spider phobia are more likely to first fixate on spider-relevant material compared to neutral material
                                 "(stim_pho + groupspider:stim_pho) - (stim_neg + groupspider:stim_neg) >= 0"
                                 # Patients with spider phobia are more likely to first fixate on spider-relevant material compared to negative material
                                 ))

g_h2a_equality <- glht(h2a_glm_fm_excl_triplet_item, 
                   linfct = c(
                              "stim_neg + groupocd:stim_neg = 0", 
                              # Patients with OCD will not show a bias towards negative stimuli compared to neutral stimuli
                     
                              "stim_neg + groupspider:stim_neg = 0", 
                              # Patients with spider phobia will not show a bias towards negative stimuli compared to neutral stimuli
                              
                              "stim_neg = 0", 
                              # Healthy participants will not show a bias towards negative stimuli compared to neutral stimuli
                              
                              "stim_ocd = 0", 
                              # Healthy participants will not show a bias towards OCD-relevant stimuli compared to neutral stimuli
                              
                              "stim_ocd - stim_neg = 0", 
                              # Healthy participants will not show a bias towards OCD-relevant stimuli compared to negative stimuli
                              
                              "stim_pho = 0", 
                              # Healthy participants will not show a bias towards spider-relevant stimuli compared to neutral stimuli
                              
                              "stim_pho - stim_neg = 0"
                              # Healthy participants will not show a bias towards spider-relevant stimuli compared to negative stimuli
                   ))

# Contest Directional Hypotheses
contest(h2a_glm_fm_excl_triplet_item,g_h2a_directional$linfct,joint=FALSE,ddf="Satterthwaite")

# Contest Equality Hypotheses
contest(h2a_glm_fm_excl_triplet_item,g_h2a_equality$linfct,joint=FALSE,ddf="Satterthwaite")

# Create Data Tables 
rownames_h2a_contrast_directional <- c("stim_ocd + groupocd:stim_ocd", 
                           "(stim_ocd + groupocd:stim_ocd) - (stim_neg + groupocd:stim_neg)", 
                           "stim_pho + groupspider:stim_pho",
                           "(stim_pho + groupspider:stim_pho) - (stim_neg + groupspider:stim_neg)")

rownames_h2a_contrast_equality <- c(
                                    "stim_neg + groupocd:stim_neg", 
                                    "stim_neg + groupspider:stim_neg", 
                                    "stin_neg",
                                    "stim_ocd", 
                                    "stim_ocd - stim_neg", 
                                    "stim_pho", 
                                    "stim_pho - stim_neg")

h2a_contrasts_directional <- as.data.table(contest(h2a_glm_fm_excl_triplet_item,g_h2a_directional$linfct,joint=FALSE,ddf="Satterthwaite"))
h2a_contrasts_directional <- h2a_contrasts_directional %>%
  dplyr::mutate(contrast = rownames_h2a_contrast_directional) %>%
  dplyr::relocate(contrast, .before = Estimate)

h2a_contrasts_equality <- as.data.table(contest(h2a_glm_fm_excl_triplet_item,g_h2a_equality$linfct,joint=FALSE,ddf="Satterthwaite"))
h2a_contrasts_equality <- h2a_contrasts_equality %>%
  dplyr::mutate(contrast = rownames_h2a_contrast_equality) %>%
  dplyr::relocate(contrast, .before = Estimate)

h2a_contrasts <- full_join(h2a_contrasts_directional, h2a_contrasts_equality)
datatable(h2a_contrasts)

# Export 
write_xlsx(h2a_contrasts, "/Volumes/109-psy-kp-study/044_EYE/06_Results/02_Hauptstudie/VigilanceBias/h2a_contrasts.xlsx")
```

*Guideline of Interpretation:*
**1. Contrast: OCD vs. neutral in OCD group**
Positive value: This would suggest that OCD patients show a greater likelihood of first fixating on idiosyncratic OCD-relevant material compared to neutral material (i.e., a choice bias towards OCD-relevant stimuli).

Negative value: This would indicate a lower likelihood of first fixating on OCD-relevant material compared to neutral material.

**2. Contrast: OCD vs. negative in OCD group**
Positive value: This would suggest that OCD patients show a greater bias (likelihood of first fixation) towards OCD-relevant material compared to negative material.

Negative value: This would suggest that OCD patients are more likely to fixate on negative material than OCD-relevant material.

**3. Contrast: spider vs. neutral in spider phobia group**
Positive value: This would suggest that spider phobia patients show a greater likelihood of first fixating on idiosyncratic spider-relevant material compared to neutral material (i.e., a choice bias towards spider-relevant stimuli).

Negative value: This would indicate a lower likelihood of first fixating on spider-relevant material compared to neutral material.

**4. Contrast: spider vs. negative in spider phobia group**
Positive value: This would suggest that spider phobia patients show a greater bias (likelihood of first fixation) towards spider-relevant material compared to negative material.

Negative value: This would suggest that spider patients are more likely to fixate on negative material than spider-relevant material.

**5. Contrast: OCD vs. neutral in healthy group**
Positive value: This would suggest that healthy participants are more likely to fixate on OCD-relevant stimuli compared to neutral stimuli.

Negative value: This would indicate that healthy participants are more likely to fixate on neutral stimuli over OCD-relevant stimuli.

**6. Contrast: OCD vs. negative in healthy group**
Positive value: Healthy participants show a greater likelihood of first fixating on OCD-relevant stimuli compared to negative stimuli.

Negative value: Healthy participants show a greater likelihood of first fixating on negative stimuli compared to OCD-relevant stimuli.

**7. Contrast: spider vs. neutral in healthy group**
Positive value: Healthy participants show a greater likelihood of first fixating on spider-relevant stimuli compared to neutral stimuli.

Negative value: Healthy participants show a greater likelihood of first fixating on neutral stimuli compared to spider-relevant stimuli.

**8. Contrast: spider vs. negative in healthy group**
Positive value: Healthy participants show a greater likelihood of first fixating on spider-relevant stimuli compared to negative stimuli.

Negative value: Healthy participants show a greater likelihood of first fixating on negative stimuli compared to spider-relevant stimuli.


### Hypothesis 2a - Sensitivity Analysis: Exclduing 0 Fixations on AOI
```{r h2a sensitivity analysis - excl. 0 dwelltime}
data_entrytime_excl0 <- data_entrytime %>%
  dplyr::filter(!c(IA_FIXATION_COUNT_left == 0 | IA_FIXATION_COUNT_right == 0))

#j $assign("form", formula(mlm_dwelltime))
j$assign("jl_data_entrytime_excl0", data_entrytime_excl0)
julia_command("using MixedModels")
julia_command("using JellyMe4")

# Model 4b: Exclude Triplet and Item
julia_command("h2a_glm_fm_excl_triplet_item = @formula(response ~ group + stim_ocd + stim_pho + stim_neg + group&stim_ocd + group&stim_pho + group&stim_neg + 
              (1 + stim_ocd + stim_pho | participant))")

julia_command("h2a_glm_fm_excl_triplet_item = fit(MixedModel, h2a_glm_fm_excl_triplet_item, jl_data_entrytime_excl0;contrasts=c_entrytime)")

h2a_glm_fm_excl_triplet_item_excl0 <- julia_eval("robject(:lmerMod, Tuple([h2a_glm_fm_excl_triplet_item,jl_data_entrytime_excl0]));",need_return="R")

summary(h2a_glm_fm_excl_triplet_item_excl0)
tab_model(h2a_glm_fm_excl_triplet_item_excl0)

# Export
tab_model(h2a_glm_fm_excl_triplet_item_excl0, file = "/Volumes/109-psy-kp-study/044_EYE/06_Results/02_Hauptstudie/MaintenanceBias/summary_h2a_fm_excl_triplet_item_excl0.doc")

# Define the model comparisons to test the specific hypothesis of hypothesis 2
g_h2a_directional_excl0 <- glht(h2a_glm_fm_excl_triplet_item_excl0, 
                      linfct = c("stim_ocd + groupocd:stim_ocd >= 0", 
                                 # Patients with OCD are more likely to first fixate on OCD-relevant material compared to neutral material
                                 
                                 "(stim_ocd + groupocd:stim_ocd) - (stim_neg + groupocd:stim_neg) >= 0", 
                                 # Patients with OCD are more likely to first fixate on OCD-relevant material compared to negative material
                                 
                                 "stim_pho + groupspider:stim_pho >= 0", 
                                 # Patients with spider phobia are more likely to first fixate on spider-relevant material compared to neutral material
                                 "(stim_pho + groupspider:stim_pho) - (stim_neg + groupspider:stim_neg) >= 0"
                                 # Patients with spider phobia are more likely to first fixate on spider-relevant material compared to negative material
                                 ))

g_h2a_equality_excl0 <- glht(h2a_glm_fm_excl_triplet_item_excl0, 
                   linfct = c(
                              "stim_neg + groupocd:stim_neg = 0", 
                              # Patients with OCD will not show a bias towards negative stimuli compared to neutral stimuli
                     
                              "stim_neg + groupspider:stim_neg = 0", 
                              # Patients with spider phobia will not show a bias towards negative stimuli compared to neutral stimuli
                              
                              "stim_neg = 0", 
                              # Healthy participants will not show a bias towards negative stimuli compared to neutral stimuli
                              
                              "stim_ocd = 0", 
                              # Healthy participants will not show a bias towards OCD-relevant stimuli compared to neutral stimuli
                              
                              "stim_ocd - stim_neg = 0", 
                              # Healthy participants will not show a bias towards OCD-relevant stimuli compared to negative stimuli
                              
                              "stim_pho = 0", 
                              # Healthy participants will not show a bias towards spider-relevant stimuli compared to neutral stimuli
                              
                              "stim_pho - stim_neg = 0"
                              # Healthy participants will not show a bias towards spider-relevant stimuli compared to negative stimuli
                   ))

# Contest Directional Hypotheses
contest(h2a_glm_fm_excl_triplet_item_excl0,g_h2a_directional_excl0$linfct,joint=FALSE,ddf="Satterthwaite")

# Contest Equality Hypotheses
contest(h2a_glm_fm_excl_triplet_item_excl0,g_h2a_equality_excl0$linfct,joint=FALSE,ddf="Satterthwaite")

# Create Data Tables 
rownames_h2a_contrast_directional_excl0 <- c("stim_ocd + groupocd:stim_ocd", 
                           "(stim_ocd + groupocd:stim_ocd) - (stim_neg + groupocd:stim_neg)", 
                           "stim_pho + groupspider:stim_pho",
                           "(stim_pho + groupspider:stim_pho) - (stim_neg + groupspider:stim_neg)")

rownames_h2a_contrast_equality_excl0 <- c(
                                    "stim_neg + groupocd:stim_neg", 
                                    "stim_neg + groupspider:stim_neg", 
                                    "stin_neg",
                                    "stim_ocd", 
                                    "stim_ocd - stim_neg", 
                                    "stim_pho", 
                                    "stim_pho - stim_neg")

h2a_contrasts_directional_excl0 <- as.data.table(contest(h2a_glm_fm_excl_triplet_item_excl0,g_h2a_directional_excl0$linfct,joint=FALSE,ddf="Satterthwaite"))
h2a_contrasts_directional_excl0 <- h2a_contrasts_directional_excl0 %>%
  dplyr::mutate(contrast = rownames_h2a_contrast_directional_excl0) %>%
  dplyr::relocate(contrast, .before = Estimate)

h2a_contrasts_equality_excl0 <- as.data.table(contest(h2a_glm_fm_excl_triplet_item_excl0,g_h2a_equality_excl0$linfct,joint=FALSE,ddf="Satterthwaite"))
h2a_contrasts_equality_excl0 <- h2a_contrasts_equality_excl0 %>%
  dplyr::mutate(contrast = rownames_h2a_contrast_equality_excl0) %>%
  dplyr::relocate(contrast, .before = Estimate)

h2a_contrasts_excl0 <- full_join(h2a_contrasts_directional_excl0, h2a_contrasts_equality_excl0)
datatable(h2a_contrasts_excl0)

# Export 
write_xlsx(h2a_contrasts_excl0, "/Volumes/109-psy-kp-study/044_EYE/06_Results/02_Hauptstudie/VigilanceBias/h2a_contrasts_excl0.xlsx")
```
Different effect for spider pictures (exactly the opposite).


# Hypothesis 2b: Vigilance Bias - Entry Time

```{r create julia models for H2b reaction time}
# # Model 1: Most Complex Model
# julia_command("h2b_fm_complex = @formula(rt ~ group*looked_at + looked_right*group+ 
#               (1 + looked_at + looked_right | triplet) +
#               (1 + looked_at + looked_right | participant) +
#               (1 + group | picture_pair_countingindex))")
# 
# 
# # Model 2a: Triplet ZeroCorr
# julia_command("h2b_fm_triplet_zerocorr = @formula(rt ~ group*looked_at + looked_right*group+
#               zerocorr((1 + looked_at + looked_right | triplet)) +
#               (1 + looked_at + looked_right | participant) +
#               (1 + group | picture_pair_countingindex))")
# 
# # Model 2b: Triplet and Participant ZeroCorr
# julia_command("h2b_fm_triplet_id_zerocorr = @formula(rt ~ group*looked_at + looked_right*group+
#               zerocorr((1 + looked_at + looked_right | triplet)) +
#               zerocorr((1 + looked_at + looked_right | participant)) +
#               (1 + group | picture_pair_countingindex))")
# 
# # Model 2c: Triplet, Participant and Item Effect ZeroCorr
# julia_command("h2b_fm_triplet_id_item_zerocorr = @formula(rt ~ group*looked_at + looked_right*group+ 
#               zerocorr((1 + looked_at + looked_right | triplet)) +
#               zerocorr((1 + looked_at + looked_right | participant)) +
#               zerocorr((1 + group | picture_pair_countingindex)))")
# 
# # Model 3a: Exclude Participant
# julia_command("h2b_fm_excl_id = @formula(rt ~ group*looked_at + looked_right*group+ 
#               (1 + looked_at + looked_right | triplet) +
#               (1 + group | picture_pair_countingindex))")
# 
# # Model 3b: Exclude Triplet
# julia_command("h2b_fm_excl_triplet = @formula(rt ~ group*looked_at + looked_right*group+ 
#               (1 + looked_at + looked_right | participant) +
#               (1 + group | picture_pair_countingindex))")
# 
# # Model 3c: Exclude Item
# julia_command("h2b_fm_excl_item = @formula(rt ~ group*looked_at + looked_right*group+ 
#               (1 + looked_at + looked_right | triplet) +
#               (1 + looked_at + looked_right | participant))")
# 
# # Model 4a: Exclude Participant and Triplet
# julia_command("h2b_fm_excl_triplet_id = @formula(rt ~ group*looked_at + looked_right*group+
#               (1 + group | picture_pair_countingindex))")
# 
# Model 4b: Exclude Triplet and Item
# julia_command("h2b_fm_excl_triplet_item = @formula(rt ~ group*looked_at + looked_right*group+
              # (1 + looked_at + looked_right | participant))")
julia_command("h2b_fm_excl_triplet_item = @formula(rt ~ group*looked_at + looked_right*group+
              (1 | participant))") # removed random slopes as the model (that was best-fitting) hat a singularity warning - zerocorr() did not remove the warning, removing one RS as well, so both were removed
# 
# # Model 4c: Exclude Participant and Item
# julia_command("h2b_fm_excl_id_item = @formula(rt ~ group*looked_at + looked_right*group+
#               (1 + looked_at + looked_right | triplet))")
```

## Hypothesis 2b: Run Models
```{julia define contrasts reaction time}
using RCall
using MixedModels
using JellyMe4
jl_data_entrytime = @rget data_entrytime

c_rt = Dict(:group=>DummyCoding(;base="healthy"),:looked_right=>EffectsCoding(),:looked_at=>DummyCoding(;base="neutral"))
```


```{r run julia models for H2b}
# # # Model 1
# julia_command("h2b_fm_complex = fit(LinearMixedModel, h2b_fm_complex, jl_data_entrytime,contrasts=c_rt)")
# 
# # Models 2: Zero Correlation
# julia_command("h2b_fm_trip_zc = fit(LinearMixedModel, h2b_fm_triplet_zerocorr, jl_data_entrytime,contrasts=c_rt)")
# julia_command("h2b_fm_trip_id_zc = fit(LinearMixedModel, h2b_fm_triplet_id_zerocorr, jl_data_entrytime;contrasts=c_rt)")
# julia_command("h2b_fm_trip_id_item_zc = fit(LinearMixedModel, h2b_fm_triplet_id_item_zerocorr, jl_data_entrytime;contrasts=c_rt)")
# 
# # Models 3: Exclude One Random Effect
# julia_command("h2b_fm_excl_id = fit(LinearMixedModel, h2b_fm_excl_id, jl_data_entrytime;contrasts=c_rt)")
# julia_command("h2b_fm_excl_triplet = fit(LinearMixedModel, h2b_fm_excl_triplet, jl_data_entrytime;contrasts=c_rt)")
# julia_command("h2b_fm_excl_item = fit(LinearMixedModel, h2b_fm_excl_item, jl_data_entrytime;contrasts=c_rt)")
# 
# # Models 4: Exclude Two Random Effects
# julia_command("h2b_fm_excl_triplet_id = fit(LinearMixedModel, h2b_fm_excl_triplet_id, jl_data_entrytime;contrasts=c_rt)")
julia_command("h2b_fm_excl_triplet_item = fit(LinearMixedModel, h2b_fm_excl_triplet_item, jl_data_entrytime;contrasts=c_rt)")
# julia_command("h2b_fm_excl_id_item = fit(LinearMixedModel, h2b_fm_excl_id_item, jl_data_entrytime;contrasts=c_rt)")
```

## Hypothesis 2b: Translate Models to R
```{r translate julia models for H2b}
# Model 1: Complex Model
# h2b_fm_complex <- julia_eval("robject(:lmerMod, Tuple([h2b_fm_complex,jl_data_entrytime]));",need_return="R")
# 
# # Models 2: Zero Correlation
# h2b_fm_trip_zc <- julia_eval("robject(:lmerMod, Tuple([h2b_fm_trip_zc,jl_data_entrytime]));",need_return="R")
# h2b_fm_trip_id_zc <- julia_eval("robject(:lmerMod, Tuple([h2b_fm_trip_id_zc,jl_data_entrytime]));",need_return="R")
# # h2b_fm_trip_id_item_zc <- julia_eval("robject(:lmerMod, Tuple([h2b_fm_trip_id_item_zc,jl_data_entrytime]));",need_return="R")
# 
# # Models 3: Exclude One Random Effect
# h2b_fm_excl_id <- julia_eval("robject(:lmerMod, Tuple([h2b_fm_excl_id,jl_data_entrytime]));",need_return="R")
# h2b_fm_excl_triplet <- julia_eval("robject(:lmerMod, Tuple([h2b_fm_excl_triplet,jl_data_entrytime]));",need_return="R")
# h2b_fm_excl_item <- julia_eval("robject(:lmerMod, Tuple([h2b_fm_excl_item,jl_data_entrytime]));",need_return="R")
# 
# # Models 4: Exclude Two Random Effects
# h2b_fm_excl_triplet_id <- julia_eval("robject(:lmerMod, Tuple([h2b_fm_excl_triplet_id,jl_data_entrytime]));",need_return="R")
h2b_fm_excl_triplet_item <- julia_eval("robject(:lmerMod, Tuple([h2b_fm_excl_triplet_item,jl_data_entrytime]));",need_return="R")
# h2b_fm_excl_id_item <- julia_eval("robject(:lmerMod, Tuple([h2b_fm_excl_id_item,jl_data_entrytime]));",need_return="R")
```

### Hypothesis 2b: Evaluate Best Fitting Model 
```{r evaluate best fitting model H2b}
#h2b_fm_complex, h2b_fm_trip_id_item_zc
# anova(h2b_fm_trip_zc, h2b_fm_trip_id_zc, h2b_fm_excl_id, h2b_fm_excl_triplet, h2b_fm_excl_item, h2b_fm_excl_triplet_id, h2b_fm_excl_triplet_item, h2b_fm_excl_id_item)
# best: h2b_fm_excl_triplet_item
summary(h2b_fm_excl_triplet_item)
tab_model(h2b_fm_excl_triplet_item)

# Export 
tab_model(h2b_fm_excl_triplet_item, file = "/Volumes/109-psy-kp-study/044_EYE/06_Results/02_Hauptstudie/VigilanceBias/summary_h2b_fm_excl_triplet_item.doc")
```

## Hypothesis 2b: Test of Entry Time Hypothesis With Contrasts
**Hypothesis:**
Patients with **OCD** and patients with **spider phobia** attend to **idiosyncratic disorder-relevant material faster** than they do to **neutral** or **negative** material (vigilance bias), as indicated by the entry time to the corresponding region of interest. 
**Healthy participants** will **not show a bias** towards disorder-relevant stimuli compared to negative or neutral stimuli.

```{r h2b generalised hypotheses matrices}
# Define the model comparisons to test the specific hypothesis of hypothesis 2
g_h2b_directional = (glht(h2b_fm_excl_triplet_item, (c(
                      "looked_atocd + groupocd:looked_atocd <= 0", # Patients with OCD fixate faster on idiosyncratic OCD-relevant material as compared to neutral material (entry time bias within group)
                            
                      "(looked_atocd + groupocd:looked_atocd) - (looked_atneg + groupocd:looked_atneg) <= 0", #Patients with OCD fixate faster on OCD-relevant material as compared to negative material (entry time bias within group)
                      
                      "looked_atpho + groupspider:looked_atpho <= 0", # Patients with spider phobia fixate faster on idiosyncratic spider-relevant material as compared to neutral material (entry time bias within group)
                      
                      "(looked_atpho + groupspider:looked_atpho) - (looked_atneg + groupspider:looked_atneg) <= 0" # Patients with spider phobia fixate faster on spider-relevant material as compared to negative material (entry time bias within group
))))

g_h2b_equality = (glht(h2b_fm_excl_triplet_item, (c(
                            "looked_atneg + groupocd:looked_atneg = 0", # Participants with OCD will not show a bias towards negative stimuli compared to neutral stimuli (entry time bias within OCD group)
                            
                            "looked_atneg + groupspider:looked_atneg = 0", # Participants with spider phobia will not show a bias towards negative stimuli compared to neutral stimuli (entry time bias within spider group)
                            
                            "looked_atneg = 0", # Healthy participants will not show a bias towards negative stimuli compared to neutral stimuli (entry time bias within healthy group)
                            
                            "looked_atocd = 0", # Healthy participants will not show a bias towards OCD-relevant stimuli compared to neutral stimuli (entry time bias within healthy group)
                            
                            "looked_atocd - looked_atneg = 0", # Healthy participants will not show a bias towards OCD-relevant stimuli compared to neutral stimuli (entry time bias within healthy group)
                            
                            "looked_atpho = 0", # Healthy participants will not show a bias towards spider-relevant stimuli compared to neutral stimuli (entry time bias within healthy group)
                            
                            "looked_atpho - looked_atneg = 0" # Healthy participants will not show a bias towards spider-relevant stimuli compared to neutral stimuli (entry time bias within healthy group)
))))

# Contest Directional Hypotheses
contest(h2b_fm_excl_triplet_item,g_h2b_directional$linfct,joint=FALSE,ddf="Satterthwaite")

# Contest Equality Hypotheses
contest(h2b_fm_excl_triplet_item,g_h2b_equality$linfct,joint=FALSE,ddf="Satterthwaite")

# Create Data Tables 
rownames_h2b_contrast_directional <- c("looked_atocd + groupocd:looked_atocd", 
                                       "(looked_atocd + groupocd:looked_atocd) - (looked_atneg + groupocd:looked_atneg)", 
                                       "looked_atpho + groupspider:looked_atpho",
                                       "(looked_atpho + groupspider:looked_atpho) - (looked_atneg + groupspider:looked_atneg)")
rownames_h2b_contrast_equality <- c("looked_atneg + groupocd:looked_atneg",
                                    "looked_atneg + groupspider:looked_atneg",
                                    "looked_atneg",
                                    "looked_atocd",
                                    "looked_atocd - looked_atneg",
                                    "looked_atpho",
                                    "looked_atpho - looked_atneg")


h2b_contrasts_directional <- as.data.table(contest(h2b_fm_excl_triplet_item,g_h2b_directional$linfct,joint=FALSE,ddf="Satterthwaite"))
h2b_contrasts_directional <- h2b_contrasts_directional %>%
  dplyr::mutate(contrast = rownames_h2b_contrast_directional) %>%
  dplyr::relocate(contrast, .before = Estimate)

h2b_contrasts_equality <- as.data.table(contest(h2b_fm_excl_triplet_item,g_h2b_equality$linfct,joint=FALSE,ddf="Satterthwaite"))
h2b_contrasts_equality <- h2b_contrasts_equality %>%
  dplyr::mutate(contrast = rownames_h2b_contrast_equality) %>%
  dplyr::relocate(contrast, .before = Estimate)

h2b_contrasts <- full_join(h2b_contrasts_directional, h2b_contrasts_equality)
datatable(h2b_contrasts)

# Export
write_xlsx(h2b_contrasts, "/Volumes/109-psy-kp-study/044_EYE/06_Results/02_Hauptstudie/VigilanceBias/h2b_contrasts.xlsx")
```

*Guideline of Interpretation*
**1. Contrast: OCD vs. neutral in OCD group**
Positive value: This suggests that OCD patients take longer to fixate on idiosyncratic OCD-relevant material compared to neutral material (i.e., slower entry time for OCD-relevant stimuli).

Negative value: This suggests that OCD patients fixate faster on OCD-relevant material compared to neutral material (entry time bias towards OCD-relevant stimuli).

**2. Contrast: OCD vs. negative in OCD group**
Positive value: This suggests that OCD patients take longer to fixate on OCD-relevant material compared to negative material.

Negative value: This suggests that OCD patients fixate faster on OCD-relevant material compared to negative material (entry time bias towards OCD-relevant stimuli).

**3. Contrast: spider vs. neutral in spider phobia group**
Positive value: This suggests that spider phobia patients take longer to fixate on spider-relevant material compared to neutral material.

Negative value: This suggests that spider phobia patients fixate faster on spider-relevant material compared to neutral material (entry time bias towards spider-relevant stimuli).

**4. Contrast: spider vs. negative in spider phobia group**
Positive value: This suggests that spider phobia patients take longer to fixate on spider-relevant material compared to negative material.

Negative value: This suggests that spider phobia patients fixate faster on spider-relevant material compared to negative material (entry time bias towards spider-relevant stimuli).

**5. Contrast: OCD vs. neutral in healthy group**
Positive value: This suggests that healthy participants take longer to fixate on OCD-relevant stimuli compared to neutral stimuli.

Negative value: This suggests that healthy participants fixate faster on neutral stimuli compared to OCD-relevant stimuli (i.e., no bias towards OCD-relevant stimuli).

**6. Contrast: OCD vs. negative in healthy group**
Positive value: This suggests that healthy participants take longer to fixate on OCD-relevant stimuli compared to negative stimuli.

Negative value: This suggests that healthy participants fixate faster on negative stimuli compared to OCD-relevant stimuli.

**7. Contrast: spider vs. neutral in healthy group**
Positive value: This suggests that healthy participants take longer to fixate on spider-relevant stimuli compared to neutral stimuli.

Negative value: This suggests that healthy participants fixate faster on neutral stimuli compared to spider-relevant stimuli.

**8. Contrast: spider vs. negative in healthy group**
Positive value: This suggests that healthy participants take longer to fixate on spider-relevant stimuli compared to negative stimuli.

Negative value: This suggests that healthy participants fixate faster on negative stimuli compared to spider-relevant stimuli.

# Hypothesis 2b - Sensitivity Analysis: Exclduing 0 Fixations on AOI
```{r h2b sensitivity analysis - excl. 0 dwelltime}
data_entrytime_excl0 <- data_entrytime %>%
  dplyr::filter(!c(IA_FIXATION_COUNT_left == 0 | IA_FIXATION_COUNT_right == 0))

#j $assign("form", formula(mlm_dwelltime))
j$assign("jl_data_entrytime_excl0", data_entrytime_excl0)
julia_command("using MixedModels")
julia_command("using JellyMe4")

# Model 4b: Exclude Triplet and Item
julia_command("h2b_fm_excl_triplet_item_excl0 = @formula(rt ~ group*looked_at + looked_right*group+ 
              (1 | participant))") # removed random slopes as the model (that was best-fitting) hat a singularity warning - zerocorr() did not remove the warning, removing one RS as well, so both were removed

julia_command("h2b_fm_excl_triplet_item_excl0 = fit(LinearMixedModel, h2b_fm_excl_triplet_item_excl0, jl_data_entrytime_excl0;contrasts=c_rt)")

h2b_fm_excl_triplet_item_excl0 <- julia_eval("robject(:lmerMod, Tuple([h2b_fm_excl_triplet_item_excl0,jl_data_entrytime_excl0]));",need_return="R")

summary(h2b_fm_excl_triplet_item_excl0)
tab_model(h2b_fm_excl_triplet_item_excl0)

# Export
tab_model(h2b_fm_excl_triplet_item_excl0, file = "/Volumes/109-psy-kp-study/044_EYE/06_Results/02_Hauptstudie/MaintenanceBias/summary_h2b_fm_excl_triplet_item_excl0.doc")

# Define the model comparisons to test the specific hypothesis of hypothesis 2
g_h2b_directional_excl0 = (glht(h2b_fm_excl_triplet_item_excl0, (c(
                      "looked_atocd + groupocd:looked_atocd <= 0", # Patients with OCD fixate faster on idiosyncratic OCD-relevant material as compared to neutral material (entry time bias within group)
                            
                      "(looked_atocd + groupocd:looked_atocd) - (looked_atneg + groupocd:looked_atneg) <= 0", #Patients with OCD fixate faster on OCD-relevant material as compared to negative material (entry time bias within group)
                      
                      "looked_atpho + groupspider:looked_atpho <= 0", # Patients with spider phobia fixate faster on idiosyncratic spider-relevant material as compared to neutral material (entry time bias within group)
                      
                      "(looked_atpho + groupspider:looked_atpho) - (looked_atneg + groupspider:looked_atneg) <= 0" # Patients with spider phobia fixate faster on spider-relevant material as compared to negative material (entry time bias within group
))))

g_h2b_equality_excl0 = (glht(h2b_fm_excl_triplet_item_excl0, (c(
                            "looked_atneg + groupocd:looked_atneg = 0", # Participants with OCD will not show a bias towards negative stimuli compared to neutral stimuli (entry time bias within OCD group)
                            
                            "looked_atneg + groupspider:looked_atneg = 0", # Participants with spider phobia will not show a bias towards negative stimuli compared to neutral stimuli (entry time bias within spider group)
                            
                            "looked_atneg = 0", # Healthy participants will not show a bias towards negative stimuli compared to neutral stimuli (entry time bias within healthy group)
                            
                            "looked_atocd = 0", # Healthy participants will not show a bias towards OCD-relevant stimuli compared to neutral stimuli (entry time bias within healthy group)
                            
                            "looked_atocd - looked_atneg = 0", # Healthy participants will not show a bias towards OCD-relevant stimuli compared to neutral stimuli (entry time bias within healthy group)
                            
                            "looked_atpho = 0", # Healthy participants will not show a bias towards spider-relevant stimuli compared to neutral stimuli (entry time bias within healthy group)
                            
                            "looked_atpho - looked_atneg = 0" # Healthy participants will not show a bias towards spider-relevant stimuli compared to neutral stimuli (entry time bias within healthy group)
))))

# Contest Directional Hypotheses
contest(h2b_fm_excl_triplet_item_excl0,g_h2b_directional_excl0$linfct,joint=FALSE,ddf="Satterthwaite")

# Contest Equality Hypotheses
contest(h2b_fm_excl_triplet_item_excl0,g_h2b_equality_excl0$linfct,joint=FALSE,ddf="Satterthwaite")

# Create Data Tables 
rownames_h2b_contrast_directional_excl0 <- c("looked_atocd + groupocd:looked_atocd", 
                                       "(looked_atocd + groupocd:looked_atocd) - (looked_atneg + groupocd:looked_atneg)", 
                                       "looked_atpho + groupspider:looked_atpho",
                                       "(looked_atpho + groupspider:looked_atpho) - (looked_atneg + groupspider:looked_atneg)")
rownames_h2b_contrast_equality_excl0 <- c("looked_atneg + groupocd:looked_atneg",
                                    "looked_atneg + groupspider:looked_atneg",
                                    "looked_atneg",
                                    "looked_atocd",
                                    "looked_atocd - looked_atneg",
                                    "looked_atpho",
                                    "looked_atpho - looked_atneg")
    
h2b_contrasts_directional_excl0 <- as.data.table(contest(h2b_fm_excl_triplet_item_excl0,g_h2b_directional_excl0$linfct,joint=FALSE,ddf="Satterthwaite"))
h2b_contrasts_directional_excl0 <- h2b_contrasts_directional_excl0 %>%
  dplyr::mutate(contrast = rownames_h2b_contrast_directional_excl0) %>%
  dplyr::relocate(contrast, .before = Estimate)

h2b_contrasts_equality_excl0 <- as.data.table(contest(h2b_fm_excl_triplet_item_excl0,g_h2b_equality_excl0$linfct,joint=FALSE,ddf="Satterthwaite"))
h2b_contrasts_equality_excl0 <- h2b_contrasts_equality_excl0 %>%
  dplyr::mutate(contrast = rownames_h2b_contrast_equality_excl0) %>%
  dplyr::relocate(contrast, .before = Estimate)

h2b_contrasts_excl0 <- full_join(h2b_contrasts_directional_excl0, h2b_contrasts_equality_excl0)
datatable(h2b_contrasts_excl0)

# Export 
write_xlsx(h2b_contrasts_excl0, "/Volumes/109-psy-kp-study/044_EYE/06_Results/02_Hauptstudie/VigilanceBias/h2b_contrasts_excl0.xlsx")
```



<!-- # Plots -->
<!-- ```{r plots for hypotheses} -->
<!-- # H1 -->
<!-- h1_contrasts$names <- c("OCD - OCD-relevant (1) vs. neutral (0)", "OCD - OCD-relevant (1) vs. negative (0)", "OCD (1) vs. Non-Clinical (0) - OCD-relevant", "OCD (1) vs. Spider (0) - disorder-relevant", "OCD - Negative (1) vs. Neutral (0)", "Spider - Negative (1) vs. Neutral (0)", "Healthy - Negative (1) vs. Neutral (0)") -->

<!-- h1_plot <- ggplot(h1_contrasts, aes(x = names, y = Estimate)) +  -->
<!--   geom_point() +  -->
<!--   geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.2) +  -->
<!--   labs(title = "Dwell-Time Difference", y = "Dwell Time Difference (in ms)", x = "Contrasts") + -->
<!--   theme(axis.text.x = element_text(angle = 45)) + -->
<!--   theme_minimal() + -->
<!--   theme(axis.text.x = element_text(angle = 45, hjust = 1)) # Apply 45-degree rotation to x-axis labels  -->

<!-- h1_plot -->

<!-- # H2a -->
<!-- h2a_contrasts$names <- c("OCD - OCD-relevant (0) vs. neutral (1)", "OCD - OCD-relevant (0) vs. negative (1)",  -->
<!--                             "Spider - spider-relevant (0) vs. neutral (1)", "Spider - spider-relevant (0) vs. negative (1)",  -->
<!--                             "OCD - Negative (1) vs. Neutral (0)", "Spider - Negative (1) vs. Neutral (0)", "Healthy - Negative (1) vs. Neutral (0)", -->
<!--                             "Healthy - OCD-relevant (0) vs. neutral (1)", "Healthy - OCD-relevant (0) vs. negative (1)", -->
<!--                             "Healthy - spider-relevant (0) vs. neutral (1)", "Healthy - spider-relevant (0) vs. negative (1)") -->

<!-- h2a_contrasts <- h2a_contrasts %>% -->
<!--   dplyr::mutate(Estimate_perc = Estimate*100) -->
<!-- h2a_plot <- ggplot(h2a_contrasts, aes(x = names, y = Estimate_perc)) +  -->
<!--   geom_point() +  -->
<!--   geom_errorbar(aes(ymin = lower*100, ymax = upper*100), width = 0.2) +  -->
<!--   labs(title = "First Fixation Choice", y = "Probability of First Fixation (in %)", x = "Contrasts") + -->
<!--   theme_minimal() + -->
<!--   theme(axis.text.x = element_text(angle = 45, hjust = 1))  -->
<!-- h2a_plot -->

<!-- # H2b -->
<!-- h2b_contrasts$names <- c("OCD - OCD-relevant (1) vs. neutral (0)", "OCD - OCD-relevant (1) vs. negative (0)",  -->
<!--                             "Spider - spider-relevant (1) vs. neutral (0)", "Spider - spider-relevant (1) vs. negative (0)",  -->
<!--                           "OCD - Negative (1) vs. Neutral (0)", "Spider - Negative (1) vs. Neutral (0)", "Healthy - Negative (1) vs. Neutral (0)", -->
<!--                          "Healthy - OCD-relevant (1) vs. neutral (0)", "Healthy - OCD-relevant (1) vs. negative (0)", -->
<!--                             "Healthy - spider-relevant (1) vs. neutral (0)", "Healthy - spider-relevant (1) vs. negative (0)") -->

<!-- h2b_plot <- ggplot(h2b_contrasts, aes(x = names, y = Estimate)) +  -->
<!--   geom_point() +  -->
<!--   geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.2) +  -->
<!--   labs(title = "First Fixation Latency", y = "First Fixation Latency (in ms)", x = "Contrasts") + -->
<!--   theme_minimal() + -->
<!--   theme(axis.text.x = element_text(angle = 45, hjust = 1))  -->

<!-- h2b_plot -->
<!-- ``` -->

